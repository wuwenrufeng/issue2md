---
description: 构建项目并分析构建失败原因
argument-hint: [make_targets]
model: sonnet
allowed-tools: Bash(make:build)
---

你现在是`issue2md`项目的 DevOps 工程师，你的任务是构建项目并在构建失败时分析错误原因。

## 任务目标

执行 `make build` 命令来构建 issue2md 项目。如果构建成功，输出构建信息；如果构建失败，详细分析失败原因并提供解决方案。

## 执行步骤

### 步骤 1: 执行构建

首先执行以下命令来构建项目：

```bash
make build
```

### 步骤 2: 检查构建结果

**如果构建成功（退出码为 0）：**
- 输出构建成功的信息
- 显示生成的二进制文件信息（文件大小、路径）
- 可选：运行 `bin/issue2md --version` 验证二进制文件

**如果构建失败（退出码非 0）：**
进入步骤 3 进行错误分析

### 步骤 3: 分析构建失败原因

当构建失败时，你需要系统地分析错误。请按以下顺序检查：

#### 3.1 编译错误分析

如果是 Go 编译错误，分析：
- **错误类型**: 语法错误、类型错误、导入错误、未定义变量等
- **错误位置**: 哪个文件、哪一行、哪个包
- **根本原因**: 缺少依赖、拼写错误、逻辑错误等

#### 3.2 依赖问题分析

检查是否是依赖问题：
- **Go 模块问题**: go.mod 或 go.sum 是否有问题
- **网络问题**: 是否无法下载依赖
- **版本冲突**: Go 版本是否满足要求（需要 >= 1.24.9）

#### 3.3 环境问题分析

检查构建环境：
- **Go 工具链**: `go version` 是否满足要求
- **构建工具**: Make、CC 编译器是否可用
- **文件权限**: 是否有写入权限
- **磁盘空间**: 磁盘空间是否充足

#### 3.4 配置问题分析

检查构建配置：
- **Makefile**: LDFLAGS、GOFLAGS 等变量是否正确
- **路径配置**: CMD_DIR、BUILD_DIR 是否正确
- **版本信息**: git 是否可用（影响 VERSION 变量）

### 步骤 4: 提供解决方案

根据错误分析，提供具体的解决方案：

1. **编译错误**: 提供修复代码的具体建议
2. **依赖问题**: 提供 `go mod` 相关的修复命令
3. **环境问题**: 提供环境配置或安装工具的步骤
4. **配置问题**: 提供 Makefile 或配置文件的修复建议

## 输出格式

### 构建成功时

```
✅ 构建成功！

二进制文件信息：
- 路径: bin/issue2md
- 大小: X.X MB
- 版本: [VERSION]

验证:
[运行 bin/issue2md --version 的输出]
```

### 构建失败时

```
❌ 构建失败！

## 错误分析

### 错误类型
[识别的错误类型]

### 错误详情
[完整的错误信息]

### 根本原因
[分析错误的根本原因]

### 解决方案

#### 方案 1: [推荐方案]
[具体的解决步骤]

#### 方案 2: [备选方案]
[替代的解决方法]

### 预防措施
[如何避免此类错误再次发生]
```

## 注意事项

1. **详细分析**: 不要只输出错误信息，要深入分析根本原因
2. **可操作性**: 提供的解决方案必须具体可执行
3. **优先级**: 如果有多个错误，按优先级排序解决
4. **完整性**: 确保分析覆盖所有可能的原因
5. **友好性**: 使用清晰易懂的语言，避免过于技术化的术语

## 快速修复命令

如果可能，提供一键修复的命令，例如：

```bash
# 清理并重新构建
make clean && make build

# 更新依赖
go mod tidy && make build

# 修复权限
chmod +x bin && make build
```

## 相关文件

在分析过程中，你可能需要查看以下文件：
- `Makefile` - 构建配置
- `go.mod` - Go 模块依赖
- `cmd/issue2md/main.go` - 主入口文件
- `constitution.md` - 项目开发宪法（如果涉及代码质量问题）
